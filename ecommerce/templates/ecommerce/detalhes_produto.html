{% extends "ecommerce/layout.html" %}

{% load ecommerce_filters %}

{% block body %}
<div class="container">
    <!-- Título do Produto -->
    <h2 class="mb-4 text-center text-uppercase">{{ produto }}</h2>

    <!-- Mensagens de Erro ou Sucesso -->
    <div class="erro mt-3">
        {% for message in messages %}
            {% if 'success' in message.tags %}
                <p class="alert alert-success text-center">{{ message }}</p>
            {% elif 'error' in message.tags %}
                <p class="alert alert-danger text-center">{{ message }}</p>
            {% endif %}
        {% endfor %}
    </div>

    <!-- Nota do Produto -->
    <div class="text-center mb-4">
        <span class="star-rating fs-3">
            {% for i in 5|to_range_D:0 %}
                {% if i <= produto.nota %}
                    <span class="filled-star">★</span>
                {% else %}
                    <span class="empty-star">★</span>
                {% endif %}
            {% endfor %}
        </span>
        {% if produto.nota %}
            <p class="fs-5 mt-2"><strong>{{ produto.nota }} ({{ produto.avaliacoes }})</strong></p>
        {% else %}
            <p class="fs-5 mt-2 text-muted">Nenhuma avaliação (0)</p>
        {% endif %}
    </div>

    <!-- Wishlist e Botão de Carrinho -->
    {% if user.is_authenticated and not user.is_lojista and not user.is_motorista %}
        <div class="d-flex justify-content-center gap-3 mb-4">
            <form method="post" action="{% url 'ecommerce:acionar_wishlist' produto.id %}">
                {% csrf_token %}
                <button type="submit" class="btn {% if in_wishlist %}btn-danger{% else %}btn-primary{% endif %}">
                    {% if in_wishlist %}Remover da Lista de Favoritos{% else %}Adicionar à Lista de Favoritos{% endif %}
                </button>
            </form>
            <form method="post" action="{% url 'ecommerce:adicionar_ao_carrinho' id_produto=produto.id %}">
                {% csrf_token %}
                <button type="submit" class="btn btn-success">Adicionar ao Carrinho</button>
            </form>
        </div>
    {% endif %}

    <!-- Imagem e Detalhes do Produto -->
    <div class="row mb-5">
        <!-- Imagem do Produto -->
        <div class="col-md-6 text-center">
            <img src="{{ produto.photo.url }}" alt="{{ produto }}" class="img-fluid rounded shadow-sm" style="max-height: 400px; object-fit: contain;">
        </div>
        <!-- Descrição e Preço -->
        <div class="col-md-6">
            <h3 class="text-success">R$ {{ produto.preco }}</h3>
            <p class="fs-5 mt-3">{{ produto.descricao }}</p>
            <p><strong>Quantidade em Estoque:</strong> {{ produto.estoque }}</p>
        </div>
    </div>

    <!-- Detalhes do Produto -->
    <div class="mt-4">
        <h3 class="mb-4">Detalhes</h3>
        <div class="card p-3 shadow-sm">
            <div class="d-flex align-items-center gap-3">
                {% if produto.loja.logo %}
                    <img src="{{ produto.loja.logo.url }}" alt="{{ loja.nome }}" class="rounded-circle shadow-sm" width="100" height="100">
                {% endif %}
                <h5 class="mb-0">{{ produto.loja.nome }}</h5>
            </div>
            {% if produto.categoria %}
                <p class="mt-3">Categoria: <a href="{% url 'ecommerce:produtos_categoria' produto.categoria.id %}" class="link-primary">{{ produto.categoria }}</a></p>
            {% else %}
                <p class="mt-3 text-muted">Sem categoria</p>
            {% endif %}
        </div>
    </div>
</div>
{% endblock body %}
